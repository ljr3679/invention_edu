<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd"> 
 
<mapper namespace="HomeKorAdminEventInventExam_SQL">

	<select id="HomeKorAdminEventInventExam_SQL.selectHomeKorAdminEventInventExamList" parameterType="vo" resultType="egovMap">
	/* HomeKorAdminEventInventExam_SQL.selectHomeKorAdminEventInventExamList */
		SELECT
			Z.*
		FROM
			(
				SELECT
					ROWNUM AS RNUM,
					X.*
				FROM
					(
						SELECT
							T1.no,
							T1.year_ref,
							T1.region_ref,
							T1.type_ref,
							T1.reg_no,
							T1.title,
							T1.invention,
							T1.content,
							(SELECT T2.data_name FROM cms_category_data T2 <where> AND T2.no = T1.year_ref </where>) AS year_name,
							(SELECT T3.data_name FROM cms_category_data T3 <where> AND T3.no = T1.region_ref </where>) AS region_name,
							(SELECT T4.data_name FROM cms_category_data T4 <where> AND T4.no = T1.type_ref </where>) AS type_name,
							(SELECT COUNT(1) FROM tb_exam_like T5 <where>T5.tb_invent_exam_ref = T1.no</where>) AS like_cnt,
							TO_CHAR(T1.reg_date, 'YYYY-MM-DD') AS reg_date,
							T1.register
						FROM
							tb_invent_exam T1
						<where>
						<if test='searchValue1 != ""'>
						AND			T1.year_ref														= #{searchValue1}
						</if>
						<if test='searchValue2 != ""'>
						AND			T1.region_ref													= #{searchValue2}
						</if>
						<if test='searchValue4 != ""'>
						AND			T1.type_ref														= #{searchValue4}
						</if>
						<if test='searchKeyword != ""'>
							<choose>
								<when test='searchValue3 == "0"'>
							AND
							(
										T1.reg_no													LIKE '%' || #{searchKeyword} || '%'
							OR			T1.title													LIKE '%' || #{searchKeyword} || '%'
							)
								</when>
								<when test='searchValue3 == "1"'>
							AND			T1.reg_no													LIKE '%' || #{searchKeyword} || '%'
								</when>
								<when test='searchValue3 == "2"'>
							AND			T1.title													LIKE '%' || #{searchKeyword} || '%'
								</when>
							</choose>
						</if>
						</where>
						ORDER BY 
						<choose>
							<when test='searchValue5 == "A"'>
							T1.reg_date DESC, T1.no DESC
							</when>
							<when test='searchValue5 == "B"'>
							like_cnt DESC, T1.no DESC			
							</when>
							<when test='searchValue5 == "C"'>
							T1.reg_no ASC, T1.no ASC			
							</when>
							<otherwise>
							T1.reg_date DESC, T1.no DESC
							</otherwise>
						</choose>
					) X
		) Z
		<if test='pagingYn == "Y"'>
			<where>
			<![CDATA[ AND Z.RNUM > #{firstIndex} AND ROWNUM <= #{recordCountPerPage} ]]>
			</where>
		</if>
	</select>
	
	<select id="HomeKorAdminEventInventExam_SQL.selectHomeKorAdminEventInventExamListCnt" parameterType="vo" resultType="int">
		/* HomeKorAdminEventInventExam_SQL.selectHomeKorAdminEventInventExamListCnt */
		SELECT 
			COUNT(1)
		FROM tb_invent_exam T1
		<where>
		<if test='searchValue1 != ""'>
		AND			T1.year_ref														= #{searchValue1}
		</if>
		<if test='searchValue2 != ""'>
		AND			T1.region_ref													= #{searchValue2}
		</if>
		<if test='searchValue4 != ""'>
		AND			T1.type_ref														= #{searchValue4}
		</if>
		<if test='searchKeyword != ""'>
			<choose>
				<when test='searchValue3 == "0"'>
			AND
			(
						T1.reg_no													LIKE '%' || #{searchKeyword} || '%'
			OR			T1.title													LIKE '%' || #{searchKeyword} || '%'
			)
				</when>
				<when test='searchValue3 == "1"'>
			AND			T1.reg_no													LIKE '%' || #{searchKeyword} || '%'
				</when>
				<when test='searchValue3 == "2"'>
			AND			T1.title													LIKE '%' || #{searchKeyword} || '%'
				</when>
			</choose>
		</if>
		</where>
	</select>

	<select id="HomeKorAdminEventInventExam_SQL.selectHomeKorAdminEventInventExam" parameterType="vo" resultType="egovMap">
	/* HomeKorAdminEventInventExam_SQL.selectHomeKorAdminEventInventExam */
		SELECT
			T1.no,
			T1.year_ref,
			T1.region_ref,
			T1.type_ref,
			T1.reg_no,
			T1.title,
			T1.invention,
			T1.content,
			TO_CHAR(T1.reg_date, 'YYYY-MM-DD') AS reg_date,
			T1.register
		FROM
			tb_invent_exam T1
		<where>
		AND			T1.no															= #{idx}
		</where>
		<!-- LIMIT 1 -->
	</select>
	
	<insert id="HomeKorAdminEventInventExam_SQL.insertHomeKorAdminEventInventExam" parameterType="vo">
	/* HomeKorAdminEventInventExam_SQL.insertHomeKorAdminEventInventExam */
		<selectKey resultType="vo" keyProperty="idx" order="BEFORE">
			SELECT tb_invent_exam_seq.NEXTVAL AS idx
		</selectKey>
		INSERT INTO tb_invent_exam
		(			
					no,
					year_ref,
					region_ref,
					type_ref,
					reg_no,
					title,
					invention,
					content,
					register,
					reg_date
		)
					VALUES
		(			
					#{idx},
					#{paramKey1},
					#{paramKey2},
					#{paramKey3},
					#{paramKey4},
					#{paramKey5},
					#{paramKey6},
					#{paramKey7},
					#{adm_idx},
					SYSDATE
		)
	</insert>
	
	<update id="HomeKorAdminEventInventExam_SQL.updateHomeKorAdminEventInventExam" parameterType="vo">
		/* HomeKorAdminEventInventExam_SQL.updateHomeKorAdminEventInventExam */
		UPDATE tb_invent_exam SET 
			   	year_ref																= #{paramKey1},
				region_ref																= #{paramKey2},
				type_ref																= #{paramKey3},
				reg_no																	= #{paramKey4},
				title																	= #{paramKey5},
				invention																= #{paramKey6},
				content																	= #{paramKey7},
			   	mod_date																= SYSDATE,  
			   	modifier																= #{adm_idx}        
		<where>
		AND no 																		= #{idx}
		</where>	   
		          
	</update>
	
	<delete id="HomeKorAdminEventInventExam_SQL.deleteHomeKorAdminEventInventExam" parameterType="vo">
	/* HomeKorAdminEventInventExam_SQL.deleteHomeKorAdminEventInventExam */
		DELETE FROM tb_invent_exam
		<where>
		AND			no																= #{idx}
		</where>
	</delete>
	
	<delete id="HomeKorAdminEventInventExam_SQL.deleteHomeKorAdminEventInventExamList" parameterType="vo">
		/* HomeKorAdminEventInventExam_SQL.deleteHomeKorAdminEventInventExamList */
		DELETE FROM tb_invent_exam
		<where>
			<foreach collection="paramKeyList1" open="AND no IN (" close=")" separator="," item="idx">
				#{idx}
			</foreach>
		</where>
	</delete>
	
</mapper>
