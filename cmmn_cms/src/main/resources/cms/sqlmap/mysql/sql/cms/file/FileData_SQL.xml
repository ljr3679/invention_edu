<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd"> 
 
<mapper namespace="FileData">

	<select id="FileData.selectFileDataList" parameterType="egovMap" resultType="egovMap">
	/* FileData.selectFileDataList */
		SELECT
			no,
			attach_name,
			attach_re_name,
			extension,
			mime_type,
			attach_size,
			down_cnt
		FROM
			cms_file_data
		<where>
		<choose>
			<when test='uniqueKeyList != null'>
		<foreach collection="uniqueKeyList" open="no IN (" close=")" separator="," item="key">
														#{key}
		</foreach>
			</when>
			<otherwise>
		AND			identifier							= #{identifier}
		AND			key_ref								= #{keyRef}	
			</otherwise>
		</choose>
		</where>
		ORDER BY reg_date ASC
	</select>
	
	<insert id="FileData.insertFileData" parameterType="egovMap">
	/* FileData.insertFileData */
		INSERT INTO cms_file_data
		(
			identifier,
			key_ref,
			attach_name,
			attach_re_name,
			extension,
			mime_type,
			attach_size,
			down_cnt,
			reg_date
		)
			VALUES
		(
			#{identifier},
			#{keyRef},
			#{attachName},
			#{attachReName},
			#{extension},
			#{mimeType},
			#{attachSize},
			0,
			NOW()
		)
	</insert>
	
	<delete id="FileData.deleteFileData" parameterType="vo">
	/* FileData.deleteFileData */
	<if test='fileDataRmList != null'>
		DELETE FROM cms_file_data 
		<where>
			<foreach collection="fileDataRmList" open="no IN (" close=")" separator="," item="no">
				#{no}
			</foreach>
		</where>
	</if>
	</delete>
	
	<select id="FileData.selectFileDataInfo" parameterType="str" resultType="egovMap">
	/* FileData.selectFileDataInfo */
		SELECT
			attach_name,
			attach_re_name,
			extension,
			mime_type,
			attach_size,
			down_cnt
		FROM
			cms_file_data
		<where>
		AND			no											= #{uniqueKey}
		</where>
		ORDER BY reg_date DESC
		LIMIT 1
	</select>
	
	<update id="FileData.updateFileDownloadCountDataInfo" parameterType="str">
	/* FileData.updateFileDownloadCountDataInfo */
		UPDATE cms_file_data SET down_cnt = down_cnt + 1
		<where>
		AND			no											= #{uniqueKey}
		</where>
	</update>
	
</mapper>