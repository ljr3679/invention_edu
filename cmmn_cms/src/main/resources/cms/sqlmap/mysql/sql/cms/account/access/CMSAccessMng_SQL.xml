<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd"> 
 
<mapper namespace="CmsAccessMng">

	<select id="CmsAccessMng.selectAccessDataList" parameterType="vo" resultType="egovMap">
	/* CmsAccessMng.selectAccessDataList */
		SELECT
			T1.no,
			T1.ip,
			T1.account,
			T2.id,
			T2.name,
			DATE_FORMAT(T1.reg_date,'%Y-%m-%d') AS reg_date,
			T1.reg_date AS sort_date
		FROM
			cms_ip_list T1,
			cms_admin_view T2
		<where>
		AND			T1.account									= T2.no
		</where>
		ORDER BY sort_date DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}		
	</select>
	
	<select id="CmsAccessMng.selectAccessDataListCnt" parameterType="vo" resultType="int">
	/* CmsAccessMng.selectAccessDataListCnt */
		SELECT
			COUNT(1)
		FROM
			cms_ip_list T1,
			cms_admin_view T2
		<where>
		AND			T1.account									= T2.no
		</where>
	</select>
	
	<select id="CmsAccessMng.selectIpStatus" parameterType="vo" resultType="str">
		/* CmsAccessMng.selectIpStatus */
		SELECT 
			status 
		FROM 
			cms_ip_status
		<where>
		AND			site										= #{siteCode}
		</where>
	</select>
	
	<insert id="CmsAccessMng.insertAndUpdateIpAccessStatusData" parameterType="vo">
	/* CmsAccessMng.insertAndUpdateIpAccessStatusData */
		INSERT INTO cms_ip_status
		(
			site,
			status
		)
			VALUES
		(
			#{siteCode},
			#{paramKey1}
		)
		ON DUPLICATE KEY
		UPDATE
					status										= #{paramKey1},
					modifier									= #{adm_idx},
					mod_date									= NOW()
	</insert>
	
	<select id="CmsAccessMng.selectAdminAccountDataList" parameterType="vo" resultType="egovMap">
	/* CmsAccessMng.selectAdminAccountDataList */
		SELECT
			no,
			id,
			name,
			reg_date
		FROM
			cms_admin_view
		<where>
		AND			use_at										= 'Y'
		</where>
		ORDER BY reg_date DESC
	</select>
	
	<select id="CmsAccessMng.selectAccessData" parameterType="vo" resultType="egovMap">
	/* CmsAccessMng.selectAccessData */
		SELECT
			T1.no,
			T1.ip,
			T1.account,
			T2.id AS register_id,
			T2.name AS register_name,
			T3.id AS modifier_id,
			T3.name AS modifier_name,
			DATE_FORMAT(T1.reg_date,'%Y-%m-%d %h:%i:%s') AS reg_date,
			DATE_FORMAT(T1.mod_date,'%Y-%m-%d %h:%i:%s') AS mod_date
		FROM
			cms_ip_list T1
		LEFT OUTER JOIN
			cms_admin_view T2
		ON			T1.register										= T2.no
		LEFT OUTER JOIN
			cms_admin_view T3
		ON			T1.modifier										= T3.no
		<where>
		AND			T1.no											= #{idx}
		</where>
	</select>
	
	<insert id="CmsAccessMng.insertAccessData" parameterType="vo">
	/* CmsAccessMng.insertAccessData */
		INSERT INTO cms_ip_list
		(
			ip,
			account,
			register,
			reg_date
		)
			VALUES
		(
			#{paramKey1},
			#{paramKey2},
			#{adm_idx},
			NOW()
		)
	</insert>
	
	<update id="CmsAccessMng.updateAccessData" parameterType="vo">
	/* CmsAccessMng.updateAccessData */
		UPDATE cms_ip_list SET
					ip								= #{paramKey1},
					account							= #{paramKey2},
					modifier						= #{adm_idx},
					mod_date						= NOW()
		<where>
		AND			no								= #{idx}
		</where>
	</update>
	
	<delete id="CmsAccessMng.deleteAccessDataList" parameterType="vo">
	/* CmsAccessMng.deleteAccessDataList */
	<if test='paramKeyList1 != null'>
		DELETE FROM cms_ip_list
		<where>
			<foreach collection="paramKeyList1" open="no IN (" close=")" separator="," item="idx">
				#{idx}
			</foreach>
		</where>
	</if>
	</delete>
	
</mapper>
